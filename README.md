# MagnetController / 磁控助手

一款利用手机磁力计把磁铁动作映射成多媒体控制的 Android 前台服务示例。贴近或移开磁铁即可完成播放/暂停、上/下曲、音量调节或语音助手唤醒，戴手套、骑行、跑步、滑雪都能盲按操控。

## 环境要求
- **Android 8.0+（minSdk 26）且内置磁力计的设备**：通过磁场变化触发动作。
- **带清晰 N/S 极的钕磁铁/磁力扣**：用于贴合或靠近设备，短按/长按映射不同动作。
- **要控制的播放设备**：可以是本机，也可以是蓝牙/有线耳机、音箱或车机，触发后由媒体按键事件完成控制。

## 核心能力
- **前台磁力监听服务**：自动归零、动态调节采样率，检测磁场强度/极性变化，抑制长时间强磁贴合误触发。
- **可配置的动作映射**：支持无极性/区分 N/S 两种模式的长按与短按，自带播放/暂停、上下曲、语音助手、音量增减等选项。
- **蓝牙白名单**：仅在连接指定耳机/音箱时执行动作，避免外放尴尬。
- **状态展示与手动归零**：主界面实时显示三轴磁场、强度、极性与监听状态，可一键手动归零。

## 快速开始
1. 用 Android Studio 打开项目或命令行执行 `./gradlew assembleDebug` 生成安装包。
2. 安装到有磁力计的设备，首次启动后授予前台运行/通知等必要权限。
3. 如需后台直接唤起语音助手，在系统无障碍设置开启 **MagnetController 语音服务**。
4. 连接蓝牙耳机/音箱（如需远程控制），打开应用后将磁铁贴近设备指定位置试用，按提示调整灵敏度和动作映射。

## 操作说明
- **短按/长按**：磁场强度跨过触发阈值开始计时，低于恢复阈值视为抬起；超过长按时间执行长按动作。默认短按播放/暂停，长按唤醒语音助手。
- **极性模式**：可选择不区分极性（全局共用动作）或区分 N/S 极映射不同动作。
- **自动/手动归零**：磁场稳定或持续较低时自动归零；感觉漂移时在主界面点击“手动归零”。
- **节能与抑制**：低磁场时自动降低采样频率；检测到强磁稳定贴合时忽略触发，降低误判与耗电。

## 主要配置项
| 选项 | 作用 | 默认 |
| --- | --- | --- |
| 触发/恢复阈值 | 磁场强度超过触发阈值计时，低于恢复阈值结束并执行短按 | 500 μT / 300 μT |
| 长按时长 | 超过该时长视为长按 | 1.5 s |
| 动作映射 | 无极性或区分 N/S 的长/短按动作（播放/暂停、上下曲、语音、音量±） | 见设置页 |
| 节能/采样 | 低磁场时降低采样频率的阈值与保持时间 | 100 μT / 2 s |
| 自动归零 | 低磁场持续或稳定带宽触发自动归零 | 4 s / 20 μT（可调） |
| 强磁抑制 | 检测到强磁稳定贴合时忽略触发并提示 | 1.8 mT 持续 0.4 s |

## 项目结构
- `app/src/main/java/com/example/magnetcontroller`：核心业务代码（前台服务、设置页、无障碍服务等）
- `app/src/main/res`：界面布局、字符串、多尺寸图标及服务配置
- `app/src/main/AndroidManifest.xml`：应用入口、服务与权限声明

> Build by Codex
