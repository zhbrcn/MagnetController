# MagnetController

一款利用手机磁力计把磁铁动作映射成蓝牙/本机多媒体控制的 Android 前台服务示例。将磁铁靠近或移开手机，即可触发播放/暂停、上下曲、音量调整或语音助手唤醒，等同于一个可佩戴的蓝牙遥控器。

> Build by Codex

## 硬件与环境
- **Android 8.0+（minSdk 26）且内置磁力计的手机/平板**：应用通过磁场变化检测触发。
- **带有明确 N/S 极的钕磁铁/磁力戒指或磁吸扣**：用于贴合或靠近设备，短按/长按分别对应不同动作。
- **需要控制的播放设备**：可为本机，也可以是通过蓝牙/有线连接到手机的耳机、音箱或车机，磁力触发后由媒体按键事件完成控制。

## 核心能力
- **前台磁力监听服务**：`MagnetService` 运行在前台，自动归零、动态调节采样率并在检测到磁场强度或极性变化时触发动作，同时会抑制长时间强磁贴合的误触发。 
- **可配置的动作映射**：在 `SettingsActivity` 中可为无极性/双极性两种模式配置短按和长按动作，内置播放/暂停、上一曲、下一曲、语音助手、音量增减等选项。
- **语音助手兜底**：支持前台 `VoiceTriggerActivity` 直接拉起语音命令，也可通过无障碍服务 `AccessibilityVoiceService` 在后台发起唤醒。
- **状态展示与手动归零**：主界面实时显示三轴磁场、强度、极性与监听状态，并提供「手动归零」和「参数设置」入口。

## 快速开始
1. 使用 Android Studio 打开项目或在命令行执行 `./gradlew assembleDebug` 生成安装包。
2. 将 APK 安装到具备磁力计的设备上，首次启动后授予前台运行/通知等必要权限。
3. 如果希望在后台直接唤醒语音助手，进入系统无障碍设置开启 **MagnetController 语音服务**。
4. 连接蓝牙耳机/音箱（如需远程控制），打开应用后将磁铁靠近设备指定位置进行尝试，根据提示调节灵敏度和动作映射。

## 使用方式
- **短按/长按**：磁场强度跨过「触发阈值」开始计时，松开或达到长按时间将根据当前极性执行动作；默认短按播放/暂停，长按唤醒语音助手。
- **极性模式**：可选择不区分极性（所有动作共用）或区分 N/S 极分别映射不同动作，并可设定极性识别强度窗口。
- **自动/手动归零**：磁场稳定或持续较低时自动归零；如感知漂移，可在主界面点击「手动归零」重新校准基线。
- **能耗控制与抑制**：低磁场时自动降低采样率，检测到持续强磁且变化微小时会忽略触发，降低误判和耗电。

## 主要配置项
| 选项 | 作用 | 默认值 |
| --- | --- | --- |
| 触发/复位阈值 | 磁场强度超过触发阈值开始计时，低于复位阈值结束并执行短按动作 | 500 μT / 300 μT |
| 长按时长 | 超过该时长视为长按 | 1.5 s |
| 极性识别窗口 | 区分 N/S 极时的强度范围与强锁阈值 | 50–2000 μT，锁定 ≥600 μT |
| 动作映射 | 全局或分极的短按/长按动作（播放/暂停、上一曲、下一曲、语音、音量 ±） | 见设置页 |
| 省电/采样率 | 低磁场时降低采样频率的阈值与保持时间 | 100 μT，2 s |
| 自动归零 | 低磁场持续时间或稳定带宽触发自动归零 | 4 s / 20 μT（可调） |
| 强磁抑制 | 检测到强磁稳定贴合时忽略触发并提示 | 1.8 mT 持续 0.4 s |

## 项目结构
- `app/src/main/java/com/example/magnetcontroller`：核心业务代码（前台服务、设置页、无障碍服务等）。
- `app/src/main/res`：界面布局、字符串、多尺寸图标及服务配置。
- `app/src/main/AndroidManifest.xml`：应用入口、服务与权限声明。

